<link rel="stylesheet" type="text/css" href="css/background.css" />
<body>
  <br><br><br>
  <div class="container-fluid"> <!-- ng-init="firstQueryLoad()" -->
    <div class="row">
      <div class="col-xs-12 col-sm-12 col-md-12">
        <div id="decadas">
          <h2 style="margin-left:4.6%;" ng-click="highlight()">Resultados de la búsqueda <em>"{{query}}"</em></h2>
        </div>
      </div>
      <div ng-show="archivos.length != 0">
        <h2 id="tituloFiltro">Filtrar por:</h2>
        <div id="seccionFiltrado" isteven-multi-select input-model="inputQuery" output-model="outputQuery"  button-label="name" item-label="name" tick-property="ticked" orientation="horizontal" helper-elements="all none reset" on-item-click="updateVisibility()" on-select-all="updateAll()" on-select-none="updateNone()" on-reset="updateAll()"></div>
        <h3 class="tituloOrdenar" style="color:#f0fff0" ng-show="outputQuery.length"><strong>Ordenar por:</strong> <a class="linkOrdena" href="" ng-click="order('fecha')">Fecha</a> <a class="linkOrdena" href="" ng-click="order('titulo_propio')">Título</a></h3>
      </div>
      <center><h2 style="color:white" ng-show="archivos.length === 0">No hay coincidencias en la base de datos. Intente otra búsqueda.</h2></center>
    <!--<div id="seccionPortadas" infinite-scroll="firstQueryLoad()" infinite-scroll-disabled='busy'>-->
    <div id="seccionPortadas">
    <!--<div id="seccionPortadas">-->
      <div id="audiovisual">
        <a ng-repeat="archivo in archivos | orderBy:predicate:reverse" data-toggle="modal" href="" data-target="#modalInfo" class="portadasBusqueda" ng-show="archivo.show">
          <img data-trigger="hover" data-title="Aparece en:" data-content-template="popover-info.html" data-placement="top" bs-popover ng-cloak class="img-rounded" ng-click="getAllInfo(archivo.codigo_de_referencia)" ng-src="{{(archivo.imagen != '') ? ('imgs/Portadas/' + archivo.imagen) : ('imgs/Portadas/sin_imagen.png')}}">
          <p class="text-rigth">
              {{(archivo.titulo_propio.length > 40) ? (archivo.titulo_propio.substring(0,40) + "...."):(archivo.titulo_propio)}}
              <br>
              <br ng-show="archivo.titulo_propio.length < 25">
              <p class="textoA">{{(archivo.fecha != "") ? archivo.fecha : "(Sin fecha)"}}</p>
          </p>
        </a>
        <script type="text/ng-template" id="popover-info.html">
          <h5 ng-repeat="rubro in getRubros(archivo)"><span class="label label-primary">{{rubro}}</span> </h5>        
        </script>
      </div>
      <!--<div id="load" ng-cloak ng-show="!busy && (archivos.length > 5)">
        <img id="imgLoad" src="imgs/loading.gif">
      </div>-->
    </div>
  </div>

  <!--Modal que muestra la información de los audiovisuales -->
  <div ng-model="check" class="modal fade" id="modalInfo" role="dialog" aria-labelledby="gridSystemModalLabel">
    <div class="modal-dialog informacion" role="document">
      <div class="modal-content" style="background-color: rgba(38, 105, 138,0.9); color:white">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h1 class="modal-title" id="gridSystemModalLabel">{{allInfo.identificacion.titulo_propio}} 
            <a ng-show="sesion" class="iconEdicion" href="" ng-click="editar(allInfo.identificacion.codigo_de_referencia)" >
              <span class="glyphicon glyphicon-edit"></span>
            </a>
            <a type="button" data-unique="1" data-auto-close="1" data-placement="right" data-content-template="popover-tmpl.html" data-title="Eliminar registro" bs-popover ng-show="sesion" class="iconEdicion" href="">
              <span class="glyphicon glyphicon-remove-circle"></span>
            </a>
            <script type="text/ng-template" id="popover-tmpl.html">
              <form>
                    <div class="form-group">
                        ¿Seguro que deseas borrar el registro "{{allInfo.identificacion.titulo_propio}}"?
                        <br>
                        <br>
                        <label for="exampleInputPassword1">Confirmar contraseña</label>
                        <input type="password" class="form-control" id="pass" name="pass" data-ng-model="pass">
                    </div>
                    <!--Errores de Validaciones que se muestran verificando las validaciones de cada input-->
                      <div class="alert alert-danger" role="alert" ng-model="errores" style="height=20px" ng-show="errores">
                          <small class="errorConfirmacion" ng-show="errores">
                              <strong>ERROR:</strong>Contraseña invalida!
                          </small>
                      </div>
                    <button type="submit" ng-click="confirmar(user,pass)" class="btn btn-danger">Eliminar</button>
                </form>
            </script>
          </h1>
        </div>
        <div class="modal-body">
          <div class="container-fluid">
            <div class="row">
              <div class="col-md-4" >
                <img src="{{(allInfo.adicional.imagen != '') ? ('imgs/Portadas/' + allInfo.adicional.imagen) : ('imgs/Portadas/sin_imagen.JPG')}}" class="img-responsive">
              </div>
              <div class="col-md-8">
                <div id="aduracion">
                  <h4>Duración: {{allInfo.identificacion.duracion}}</h4>
                </div>
                <div id="aanio">
                  <h4>Año: {{allInfo.identificacion.fecha}}</h4>
                </div>
                <div id="tsinopsis">
                  <h2>Sinópsis</h2>
                </div>
                <div id="asinopsis">
                  {{allInfo.contenido_y_estructura.sinopsis}}
                  <p ng-show="allInfo.contenido_y_estructura.sinopsis === ''"><em>Por el momento no hay sinópsis disponible.</em></p>
                </div>
                {{allInfo.adicional.url}}
                <a href=""><span id="iconoTrailer" class="glyphicon glyphicon-facetime-video"></span></a>
                <div>
                  Búsqueda <br>
                  <div ng-repeat="(keyword, rubros) in findRubros(allInfo.identificacion.codigo_de_referencia)">
                    <span class="label label-primary" ng-click="highlight(keyword)">{{keyword}}</span> aparece en:
                    <div ng-repeat="rubro in rubros" style="margin-left:2em">
                      <span class="label label-success">{{encabezados[rubro]}}</span> 
                    </div>
                    <br> 
                  </div>
                </div>
              </div> 
            </div>
          </div>
          <hr>
            <div class= "row">
              <div id="aboton" ng-show="!hideInfo">      
                <button type="button" ng-click="hideInfos()" class="btn btn-primary btn-lg btn-block">Ver más <span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span></button>
              </div>
              <div ng-show="hideInfo" class="contenedorInfo">
                <!-- Nav tabs -->
                <ul class="nav nav-pills" role="presentation" id="myTab">
                  <li ng-show="!isEmpty(allInfo.identificacion)" role="presentation" class="active"><a class="etiqueta" href="#identificacion" role="tab" data-toggle="tab">Identificación</a></li>
                  <li ng-show="!isEmpty(allInfo.contexto)" role="presentation"><a class="etiqueta" href="#contexto" aria-controls="contexto" role="tab" data-toggle="tab">Contexto</a></li>
                  <li ng-show="!isEmpty(allInfo.contenido_y_estructura)" role="presentation"><a class="etiqueta" href="#contenido_y_estructura" aria-controls="contenido_y_estructura" role="tab" data-toggle="tab">Contenido y Estructura</a></li>
                  <li ng-show="!isEmpty(allInfo.condiciones_de_acceso)" role="presentation"><a class="etiqueta" href="#condiciones_de_acceso" aria-controls="condiciones_de_acceso" role="tab" data-toggle="tab">Condiciones de Acceso</a></li>
                  <li ng-show="!isEmpty(allInfo.documentacion_asociada)" role="presentation"><a class="etiqueta" href="#documentacion_asociada" aria-controls="documentacion_asociada" role="tab" data-toggle="tab">Documentación Asociada</a></li>
                  <li ng-show="!isEmpty(allInfo.notas)" role="presentation"><a class="etiqueta" href="#notas" aria-controls="notas" role="tab" data-toggle="tab">Notas</a></li>
                  <li ng-show="!isEmpty(allInfo.descripcion) && permiso > 0" role="presentation"><a class="etiqueta" href="#descripcion" aria-controls="descripcion" role="tab" data-toggle="tab">Descripción</a></li>
                </ul>
                <hr style="margin-top: 0%;">
                <center><h4><strong>{{allInfo.identificacion.titulo_propio}}</strong></h4></center>
                <!-- Tab panes -->
                <div class="tab-content">
                  <div class="tab-pane active" id="identificacion">
                    <table class="table audiovisualTable">
                      <tbody>
                        <tr ng-repeat="key in notSort(allInfo.identificacion)" ng-show="allInfo.identificacion[key] != ''">
                          <td class="col-xs-2 col-xs-2 col-md-2 col-lg-2 col-lg-2"><strong>{{encabezados[key]}}</strong></td>
                          <td class="col-xs-10 col-xs-10 col-md-10 col-lg-10 col-lg-10">{{allInfo.identificacion[key]}}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div role="tabpanel" class="tab-pane" id="contexto">
                    <table class="table audiovisualTable">
                      <tbody>
                        <tr ng-repeat="key in notSort(allInfo.contexto)" ng-show="allInfo.contexto[key] != ''">
                          <td class="col-xs-2 col-md-2 col-lg-2"><strong>{{encabezados[key]}}</strong></td>
                          <td class="col-xs-10 col-md-10 col-lg-10">{{allInfo.contexto[key]}}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div role="tabpanel" class="tab-pane" id="contenido_y_estructura">
                    <table class="table audiovisualTable">
                      <tbody>
                        <tr ng-repeat="key in notSort(allInfo.contenido_y_estructura)" ng-show="allInfo.contenido_y_estructura[key] != ''">
                          <td class="col-xs-2 col-md-2 col-lg-2"><strong>{{encabezados[key]}}</strong></td>
                          <td class="col-xs-10 col-md-10 col-lg-10">{{allInfo.contenido_y_estructura[key]}}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div role="tabpanel" class="tab-pane" id="condiciones_de_acceso">
                    <table class="table audiovisualTable">
                      <tbody>
                        <tr ng-repeat="key in notSort(allInfo.condiciones_de_acceso)" ng-show="allInfo.condiciones_de_acceso[key] != ''">
                          <td class="col-xs-2 col-md-2 col-lg-2"><strong>{{encabezados[key]}}</strong></td>
                          <td class="col-xs-10 col-md-10 col-lg-10">{{allInfo.condiciones_de_acceso[key]}}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div role="tabpanel" class="tab-pane" id="documentacion_asociada">
                     <table class="table audiovisualTable">
                      <tbody>
                        <tr ng-repeat="key in notSort(allInfo.documentacion_asociada)" ng-show="allInfo.documentacion_asociada[key] != ''">
                          <td class="col-xs-2 col-md-2 col-lg-2"><strong>{{encabezados[key]}}</strong></td>
                          <td class="col-xs-10 col-md-10 col-lg-10">{{allInfo.documentacion_asociada[key]}}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div role="tabpanel" class="tab-pane" id="notas">
                    {{allInfo.notas['area_de_notas']}}
                  </div>
                  <div role="tabpanel" class="tab-pane" id="descripcion">
                    <table class="table audiovisualTable">
                      <tbody>
                        <tr ng-repeat="key in notSort(allInfo.descripcion)" ng-show="allInfo.descripcion[key] != ''">
                          <td class="col-xs-2 col-md-2 col-lg-2"><strong>{{encabezados[key]}}</strong></td>
                          <td class="col-xs-10 col-md-10 col-lg-10">{{allInfo.descripcion[key]}}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</body>
<!--Togglable Tab para mostrar toda la información de cada audiovisual-->
<script type="text/javascript">
    $(document).ready(function(){
        $('#modalInfo').on('hidden.bs.modal', function () {
          
        });
        $('#myTab').click(function(e){
          e.preventDefault();
          $(this).tab('show');
        });
    });
</script>
